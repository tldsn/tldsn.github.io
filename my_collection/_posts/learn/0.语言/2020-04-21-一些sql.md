---
layout: post
title: 一些sql
categories: 语言
tags: sql 
author: tldsn
---

* content
{:toc}

### 一些sql

```sql
select  DATE_FORMAT(now(),'%Y-%m-%d') statdate, project_name projectname,
SUM(if(status=0,1,0)) success,
SUM(if(status!=0,1,0)) fail,
truncate(SUM(if(status=0,1,0))/count(*)*100,2) successrate,  
max(a.add_time) lastaddtime 
from t_log_crawl a
where a.add_date  = DATE_FORMAT(now(),'%Y-%m-%d')
group by projectname;
```





* * * * *

```sql
select  DATE_FORMAT(now(),'%Y-%m-%d') statdate, project_name projectname,
SUM(if(status=0,1,0)) success,
SUM(if(status!=0,1,0)) fail,
truncate(SUM(if(status=0,1,0))/count(*)*100,2) successrate,
max(a.add_time) lastaddtime   
from t_log_crawl a
where  a.add_time > now()- INTERVAL 5 MINUTE
group by projectname;
```

* * * * *

```sql
select
now() lastTime,
count(*) total,
sum(if(a.heartbeat_time > now()- INTERVAL 1 MINUTE,1,0)) onlineNum,
round(sum(if(a.heartbeat_time > now()- INTERVAL 1 MINUTE,1,0))/count(*)*100,2) onlineRate
from t_crawler a
where a.is_valid = 1;
```

* * * * *

```sql
select
b.`name` name,
count(*) total,
sum(if(a.heartbeat_time > now()- INTERVAL 1 MINUTE,1,0)) onlineNum,
round(sum(if(a.heartbeat_time > now()- INTERVAL 1 MINUTE,1,0))/count(*)*100,2) onlineRate
from  t_crawler a,t_project b
where a.is_valid = 1 and b.status = 0 and FIND_IN_SET(b.name,a.project_list)
group by name
order by 4 desc;
```